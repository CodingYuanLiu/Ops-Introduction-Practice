# Computer Network 计算机网络
## Introduction 导入

> 早期计算机技术并没有与网络通信技术直接联系。随着工业、
商业与军事部门的使用计算机的深入，
人们需要将分散在不同地方的数据进行集中处理。因此，
人们发明了一种叫做`收发器`的终端设备，可以将穿孔卡片上的数据利用电话线路发送到远处的计算机。

由此，形成了 `终端-通信线路-计算机`，这也是计算机网络的雏形。

此后计算机网络不断发展，至今一共经历了四个阶段:
* 面向终端的计算机通信网络</br>
    &nbsp;&nbsp;

    此阶段通过网络连接的时终端，比如电话机等，计算机作为中心，
    所有网络均连接到计算机上，计算机获取网络上的数据进行集中处理。
* 计算机互联网络
    &nbsp;&nbsp;
    此阶段建立在`英国国家物理实验室 NPL 的Davies提出的分组(Packet)概念基础上`。
    核心时`分组交换技术`，相当于使用通信网络将`面向终端的计算机`连起来，是的计算机不仅可以获取终端的数据，
    还可以访问网络上的其他计算机提供的资源。
* 具有统一的网络体系结构、遵循国际标准化协议的标准计算机网络
    &nbsp;&nbsp;
    基于`计算机互联网络`，计算机网络体系结构不断发展，为了使得不同体系结构的计算机可以相互连通，
    国际标准化组织ISO提出了一个能使各种计算机在世界范围内互联成网的标准框架 ————
    开放系统互连参考模型(Open System Interconnection Reference Model, OSI/RM)
* 网络互联与高速网络
    &nbsp;&nbsp;
    此阶段的计算机网络已经告诉发展，形成了遍布全球的通信网络`Internet`。此阶段
    的计算机实现了IP化，应用TCP/IP协议组建整个通信网。

## Basis Of Computer Network (网络基础知识)
* IPv4</br>
    由四个8位整数组成，范围 0 ~ 255。部分IP保留位内部局域网及广播等用途
    * 10.*， 192.168.*， 172.16.* ~ 172.31.* 保留位内部局域网
    * 127.* 软件回环测试
* 子网掩码</br>
    IP由网络号和主机号构成，比如192.168.1.2/24, 则192.168.1就是网络号(Net-ID),
    2则是主机号。</br>
    其中 /24 既是掩码，用来判断网络号和主机号，从而判断两个IP是否是同一个网段
    下</br>
    /24的意思是: 24个1，从掩码的角度看，也即是在该网段下，所有IP前面的24位bit
    都是一样的。并且，掩码和IP获的网络号的方法是 Net-ID & 子网掩码(255.255.255.0)
* 常见模型
    * OSI/RM 七层网络模型 (Open Sysem Inderconnect)</br>
        OSI 模型系统全面，理论研究完整，分层结构较为清晰，但是因为分了
        7层，实现复杂度较高，在实际应用中比较少
    * TCP/IP 四层网络模型(也可以说是三层)</br>
        TCP/IP 模型实在网络建立起来之后，根据协议建立的模型，应用上完全适应
        TCP/IP协议，但是相比OSI模型理论并不完整。因为只有四层，实现和应用都比
        OSI模型方便，应用也更加广泛

* 种类
    * 无线网 (WIFI)</br>
        * 没有可见介质，传输依靠红外线、微波、无线电等介质。
        * 无线信号以电磁波的形式存在
    * 有线网 (Wired Network)</br>
        * 传输依靠双绞线、同轴电缆、光缆等
* 传输参数
    * 数据传输速率</br>
    即常见的网速，单位一般为 bps, bit per second. 单位时间内，传送的二进制的
    有效位数
    * 波特率</br>
        * 也称位调制速率、波形速率或者码元速率。描述单位时间内传送的波形数，1 Baud 代表
        一秒钟内，传送了1 个波形
        * 波形对应数字信号，即bit，若是`二相调制`，即一个波形对应2个bit, 低电平、
        高电平。若是`四相调制`,即一个波形对应4个bit， 0，1/4，1/2，1四个bit。
        * 波特率(B)和数据传输速率(S)有对应关系，S = Blog<sub>2</sub>n
* 硬件
    * 调制解调器</br>
    * 链路交换机</br>
    * 路由器</br>
    
## Top-Down Approach 自顶向下分析因特网
### Introduction 
在Internet传输

![Internet协议工作Flow](./imgs/netwrok-workflow.png)

### Application 应用层

#### Protocols 主要协议
1. HTTP 协议
    * HTTP协议使用TCP作为其支撑运输协议。HTTP客户首先发起一个与服务器的连接，建立连接后，通过套接字收发报文。
    * HTTP协议是**非持续链接**的协议，因此HTTP协议在获取DOC文档对象后对文档进行解析，得到其他文档的引用，例如图片的引用，CSS文件的引用，再重复获取DOC文档的流程，进行TCP连接获取这些引用文档的数据。

2. SMTP 协议
    * SMTP协议是早期提出来的，英特网电子邮件应用的核心。
    * SMTP协议仅支持ASCII字节码，因此如果需要使用SMTO协议传输二进制，需要进行转码。( XMPP也是这样的，不过也有相应的二进制提议解决方案
3. FTP 协议 
    * 文件传输协议。
    * FTP使用两个并行的TCP连接进行传输文件，一个是 `控制连接`, 一个是 `数据连接`。
    * `控制连接`在FTP客户端首先在服务器21端口发起控制的TCP连接时建立。FTP客户端通过该控制连接发送用户的标识和口令，更改远程服务器目录(创建文件、删除文件...)命令也是通过控制连接进行发送。当服务器在控制连接收到文件传输的命令后，就发起一个到客户端的TCP数据连接，(通过控制连接辨别客户端)

#### TCP / UDP
1. TCP 传输
    > TCP传输服务包括面向连接服务和可靠数据传输服务。

    * 面向连接的服务
        * 在应用层数据报文考试流动之前，TCP让客户和服务器交换运输层控制信息，即所谓的握手。
        * 握手完成之后, 一个TCP连接就在两个进程的套接字之间建立了，并且这个连接是全双工的，即连接双方可以同时进行报文收发。
    * 可靠的数据传送服务
        * 依靠TCP可以就行无差错、按照适当顺序的数据交换。
    * 拥塞控制机制

2. UDP 传输
    > UDP传输服务仅提供最小服务，不提供不必要服务的轻量级运输服务。
    
    UDP是无连接的，它提供的数据传输服务是不可靠的，因为它在传输前不会确定目的地是否连接成功，并且也不保证传输顺序。</br>
    也因此，UDP是一种轻量级传输服务，应用在容错性大的app上效率较高。


Applications choices    
|应用|应用层协议|支撑的运输协议|
|---|---|---|
|电子邮件|SMTP|TCP|
|Web|HTTP|TCP|
|文件传输|FTP|TCP|
|即时通讯|XMPP，QQ |UDP、TCP|

#### DNS (Domain Name System)
由于计算机的表示和人记忆的差别，在计算机中采用的定长数字串IP地址，对于人来来说并不是很友好。于是就产生了主机名，比如 www.baidu.com, www.google.com，为了能够使计算机和人类都能够很方便的表示记忆主机的名称，就产生了一个对应表，202.120.40.8是IP地址，计算机知道，人类只需要记忆 www.xxx.xxx 就行了

> DNS是: 1. 一个由分层的DNS服务器实现的分布式数据库。2. 一个使得主机能够查询分布式数据库的应用层协议。

> DNS服务器通常是运行在 BIND(Berkeley Internet Name Domain) 软件 的 UNIX机器。DNS协议运行在UDP之上，使用53端口。

**DNS 作用**:
1. 主机别名
    有些主机的名称比较复杂，它可以获得别名(canonical hostname)，当应用程序需要知道该主机的IP时，就可以通过DNS获取规范的主机名和IP地址。
2. 负载均衡
    有些主机名对应很多个IP，这些冗余的主机用来均衡负载。那么当有请求到这个主机名时，DNS就会按照一定的规则返回IP地址，这样做就可以分摊服务器的压力。

**DNS采用了分布式的设计方案**:

![DNS部分层次架构](./imgs/network-dns.png)

**DNS 分类**
* 根DNS服务器
* 顶级域服务器
* 权威DNS服务器

以上的分类对应于上面的DNS分布式架构图。</br>
DNS查询往往需要先发送给`根DNS服务器`，然后`根DNS服务器`通过查看顶级域名，返回`顶级域服务器`的IP列表。获取到`顶级域服务器`IP列表后，选择其中之一，发送请求，`顶级域服务器`返回对应的`权威DNS服务器`。最后发送给`权威DNS服务器`，获取目标主机的IP地址。

### Transport 运输层

#### UDP协议
> UDP协议提供除了`多路复用/分解`功能外，只提供了极少量的差错检查，当应用程序使用UDP协议进行应用开发，应用几乎是直接与IP打交道。

##### UDP 应用及特性
1. DNS 是UDP的典型应用，DNS利用了 UDP 无连接的特性，在每一次发送请求时不需要握手，直接发送请求，然后等待响应。如果没有受到相应，则重发请求或者处理失败。
2. 即时消息 也经常应用UDP协议，比如国内的QQ就是应用的UDP协议发送数据，TCP进行辅助连接。为什么采用UDP，是因为，在这种通信中，应用程序往往希望数据发送给底层之后，就尽快的发送给目的地，UDP没有三次握手的overhead；跟重要的时，TCP为了提高网络性能，有一个拥塞机制，它为了保证数据的可靠传输，可能会一直等待网络通畅，不能保证即时性；此外，在即时消息中，并不要求数据一定按照顺序，或者说一定要可靠传输，即时丢包了，对方一般也能够理解，
3. 相比TCP, UDP的首部字节长度更小，TCP是20，而UDP仅为8

##### UDP 报文结构
![报文结构](./imgs/network-udp-message.png)

1. 长度是UDP报文的数据字段的长度，即图片中应用数据(报文)的长度
2. 检验和是UDP用来检验数据是否出错的 
##### UDP差错校验
> 检验和用于确定当UDP报文段从源到目的地移动时，其中的比特是否发生了改变(例如，由于链路中的噪声干扰或者存储在路由器中时引入问题)。

校验和的计算方法如下：</br>
无论是在发送端还是接收端，都是将UDP首部四个字段进行二进制加法，最后取反。假发过程中如果出现溢出，则将溢出的高位(只可能有一位溢出)和去掉最高位的结果加法运算，用表达式表示就是 </br>
1xxx0 -> xxx0 + 1 = xxx1;

1. 在发送端
首先将检验和字段置零，然后将首部四个字段按照上述方法进行计算得到检验和

2. 在接收端
将首部四个字段进行 加法运算，溢出按照上述方法处理。如果最后得到的和是 11111, 全1则数据没有丢失或者变形，否则数据出现了丢失或者变形。

#### TCP协议

* TCP是面向连接的，即进程间在发送数据之前必须先相互“握手”
* TCP运行在终端中。
* TCP是全双工的服务。

**TCP 发送接受数据流程**</br>
!(TCP收发数据图)[./imgs/networl-tcp-flow.png]
> TCP建立连接后，发送端的TCP将数据引导入该链接的**发送缓存**里，发送缓存是在三次握手初期设置的缓存之一。然后，TCP会在最方便的时候从发送缓存里去除一块数据进行发送。TCP从缓存中去除并放入报文中的数据量由`最大报文段长度(Maximum Segment Size, MSS)`限制。MSS通常根据最初确定的由本地发送主机发送的最大链路层帧长度(最大传输单元 Maximum Transmission Unit, MTU)设置来保证一个TCP报文段加上TCP/IP头适应一个链路层帧

**TCP 报文结构**
![TCP报文结构](./imgs/network-tcp-message.png)
1. 序号和确认号是用来实现可靠数据传输的
2. 接收窗口字段用于流量控制，这个字段表示接收方愿意接受的字节数量
3. ACK是确认字段，用来标志几个报文段已经被成功接收；RST、SYN、FIN适用于TCP连接建立和拆除的

##### TCP可靠传输机理
1. 序号和确认号

    **序号**
    > TCP把数据看成一个无结构的、有序的字节流。序号建立在传送的字节流上，而不是建立在传送的报文段的序列之上。一个报文段的序号是该报文段首字节的字节流编号。

    因此序号是对数据字节流的编号。
    比如，传输一个500000字节的文件，MSS(Maximum Segment Size 最大段大小，指传输时TCP数据最大大小)为1000，那么TCP将会构建500个报文段，假设第一个报文段序号为10，那么第二个就是1010，第三个就是2010，以此类推。

    ![TCP报文字段——序号](./imgs/network-tcp-序号.png)

    **确认号**</br>
    确认号是在主机A接受到数据后，发送给B的报文中填写希望得到的报文段的序号。

    > 举例来说，主机A已经收到包含字节 0 ~ 535的报文段，在收到第二个报文段(字节536 ~ 899) 之前收到第三个报文段（字节 900 ~ 1000）。第三个报文段是**失序到达**，那么主机A的TCP就会在下一个发送给B的报文段中添加确认号字段 536，致于已经收到的是**失序到达**的报文段如何处理，RFC并没有明确，由编程实现的代码决定

2. 


### Network 网络层
### Data Link 链路层、物理层



## Different Types Of Network

### LAN 局域网
#### WHAT IS LAN 什么是局域网

#### HOWT TO MEASURE


### WAN 广域网
#### WHAT IS WAN
#### HOWT TO MEASURE

### Difference Between LAN & WAN 局域网和广域网之间的区别
* 覆盖范围
* 传输介质
    * LAN

    * WAN
* 通信方式
* 通信管理
* 通信效率
* 网络性能

### Wired Network 有线网
#### WHAT IS LAN
#### HOWT TO MEASURE

### WLAN 无线局域网 Wireless Local Area Network
#### WHAT IS LAN
#### HOWT TO MEASURE


### WPAN 无线个人局域网


### 1G、2G、3G、4G 蜂窝数据移动网络
